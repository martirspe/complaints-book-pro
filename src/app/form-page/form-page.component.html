<div class="ugf-wraper">
  <div class="ugf-wrapper">
    <div class="logo">
      <a href="/">
        <img [src]="branding?.logoLightUrl" class="img-fluid logo-white" alt="logo">
        <img [src]="branding?.logoDarkUrl" class="img-fluid logo-black" alt="logo">
      </a>
    </div>
    <div *ngIf="!flag" class="ugf-content-block">
      <div class="content-block">
        <h1>¬øQu√© es un reclamo?</h1>
        <p>Es la comunicaci√≥n que puedes establecer con nosotros ante una posible insatisfacci√≥n o disconformidad con un
          producto o servicio prestado por el proveedor, con la finalidad de que √©stos sean solucionados.</p>
      </div>
    </div>
    <div *ngIf="flag" class="ugf-content-block">
      <div class="content-block">
        <h1>¬øQu√© es una queja?</h1>
        <p>Es la comunicaci√≥n que puedes establecer con nosotros ante una disconformidad relacionada a los productos o
          servicios, con la finalidad de que √©stos sean solucionados.</p>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-lg-5 offset-lg-7 p-sm-0">
          <div class="ufg-job-application-wrapper">
            <!-- Stepper descriptivo (clicable) -->
            <div class="stepper-container" aria-label="Progreso del formulario">
              <div class="stepper-steps">
                <div class="step-item" *ngFor="let label of stepLabels; let i = index"
                  [class.active]="currentStep === i + 1" [class.completed]="currentStep > i + 1"
                  [class.clickable]="canNavigateTo(i + 1)" [class.disabled]="!canNavigateTo(i + 1)"
                  [attr.tabindex]="canNavigateTo(i + 1) ? 0 : -1" (click)="onStepClick(i + 1)"
                  (keyup.enter)="onStepClick(i + 1)" [attr.aria-current]="currentStep === i + 1 ? 'step' : null"
                  [attr.aria-disabled]="!canNavigateTo(i + 1)">
                  <div class="step-number">{{ i + 1 }}</div>
                  <div class="step-label">{{ label }}</div>
                </div>
              </div>
            </div>
            <form [formGroup]="claimForm" class="job-application-form" autocomplete="off">
              <div class="form-steps" [class.active]="currentStep === 1">
                <h3><i class="las la-user-circle"></i> Identificaci√≥n del Consumidor Reclamante</h3>
                <div class="row">
                  <div class="col-sm-6 p-sm-0">
                    <div class="form-group">
                      <div class="select-input">
                        <span></span>
                        <select formControlName="document_type_id" id="document_type_id" class="form-control"
                          [class.is-invalid]="isFieldInvalid('document_type_id')"
                          [class.is-valid]="isFieldValid('document_type_id')">
                          <option value="">Elija tipo de documento</option>
                          <option *ngFor="let type of documentTypes" [value]="type.id">
                            {{type.name}}
                          </option>
                        </select>
                        <div class="invalid-feedback">
                          <div class="error-message">{{ getFieldError('document_type_id') }}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6 p-sm-0">
                    <div class="form-group">
                      <input type="tel" inputmode="numeric" class="form-control" formControlName="document_number"
                        id="document_number" [class.is-invalid]="isFieldInvalid('document_number')"
                        [class.is-valid]="isFieldValid('document_number')" required aria-describedby="doc-help">
                      <label for="document_number">No. documento</label>
                      <span class="autofill-badge" *ngIf="customerAutoFilled">‚úì Encontrado</span>
                      <small id="doc-help" class="form-text text-muted">{{ docNumberHint }}</small>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('document_number') }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-6 p-sm-0">
                    <div class="form-group">
                      <input type="text" class="form-control" formControlName="first_name" id="first_name"
                        [class.is-invalid]="isFieldInvalid('first_name')" [class.is-valid]="isFieldValid('first_name')"
                        required>
                      <label for="first_name">Nombres</label>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('first_name') }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6 p-sm-0">
                    <div class="form-group">
                      <input type="text" class="form-control" formControlName="last_name" id="last_name"
                        [class.is-invalid]="isFieldInvalid('last_name')" [class.is-valid]="isFieldValid('last_name')"
                        required>
                      <label for="last_name">Apellidos</label>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('last_name') }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-6 p-sm-0">
                    <div class="form-group">
                      <input type="tel" inputmode="numeric" class="form-control" formControlName="celphone"
                        id="celphone" [class.is-invalid]="isFieldInvalid('celphone')"
                        [class.is-valid]="isFieldValid('celphone')" maxlength="9" required>
                      <label for="celphone">Celular</label>
                      <small class="form-text text-muted">N√∫mero de 9 d√≠gitos</small>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('celphone') }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6 p-sm-0">
                    <div class="form-group">
                      <input type="email" class="form-control" formControlName="email" id="email"
                        [class.is-invalid]="isFieldInvalid('email')" [class.is-valid]="isFieldValid('email')" required>
                      <label for="email">Correo electr√≥nico</label>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('email') }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12 p-sm-0">
                    <div class="form-group">
                      <input type="text" class="form-control" formControlName="address" id="address"
                        [class.is-invalid]="isFieldInvalid('address')" [class.is-valid]="isFieldValid('address')"
                        required>
                      <label for="address">Direcci√≥n actual</label>
                      <small class="form-text text-muted">Incluye calle, n√∫mero, distrito y ciudad</small>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('address') }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12 p-sm-0">
                    <div class="form-group check-gender">
                      <span class="lebel-text">¬øEl consumidor es menor de 18 a√±os?</span>
                      <div class="custom-radio">
                        <input (click)="isYounger(true)" type="radio" name="younger" class="custom-control-input"
                          id="simenor" aria-label="S√≠, es menor de edad">
                        <label class="custom-control-label" for="simenor">S√≠</label>
                      </div>
                      <div class="custom-radio">
                        <input (click)="isYounger(false)" type="radio" name="younger" class="custom-control-input"
                          id="nomenor" checked aria-label="No, es mayor de edad">
                        <label class="custom-control-label" for="nomenor">No</label>
                      </div>
                      <small class="form-text text-muted">Si es menor, necesitaremos los datos del tutor legal</small>
                    </div>
                  </div>
                </div>
                <div *ngIf="isYouger" class="adult tutor-section">
                  <h4 class="section-title"><i class="las la-shield-alt"></i> Datos del Tutor Legal</h4>
                  <div class="row">
                    <div class="col-sm-6 p-sm-0">
                      <div class="form-group">
                        <div class="select-input">
                          <span></span>
                          <select formControlName="document_type_tutor_id" id="document_type_tutor_id"
                            class="form-control" [class.is-invalid]="isFieldInvalid('document_type_tutor_id')"
                            [class.is-valid]="isFieldValid('document_type_tutor_id')">
                            <option value="">Elija tipo de documento</option>
                            <option *ngFor="let type of documentTypes" [value]="type.id">
                              {{type.name}}
                            </option>
                          </select>
                          <div class="invalid-feedback">
                            <div class="error-message">{{ getFieldError('document_type_tutor_id') }}</div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-6 p-sm-0">
                      <div class="form-group">
                        <input type="tel" inputmode="numeric" class="form-control"
                          formControlName="document_number_tutor" id="document_number_tutor"
                          [class.is-invalid]="isFieldInvalid('document_number_tutor')"
                          [class.is-valid]="isFieldValid('document_number_tutor')" required>
                        <label for="document_number_tutor">No. documento</label>
                        <span class="autofill-badge" *ngIf="tutorAutoFilled">‚úì Encontrado</span>
                        <small class="form-text text-muted">{{ tutorDocNumberHint }}</small>
                        <div class="invalid-feedback">
                          <span>{{ getFieldError('document_number_tutor') }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-6 p-sm-0">
                      <div class="form-group">
                        <input type="text" class="form-control" formControlName="first_name_tutor" id="first_name_tutor"
                          [class.is-invalid]="isFieldInvalid('first_name_tutor')" required>
                        <label for="first_name_tutor">Nombres</label>
                        <div class="invalid-feedback">
                          <span>{{ getFieldError('first_name_tutor') }}</span>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-6 p-sm-0">
                      <div class="form-group">
                        <input type="text" class="form-control" formControlName="last_name_tutor" id="last_name_tutor"
                          [class.is-invalid]="isFieldInvalid('last_name_tutor')" required>
                        <label for="last_name_tutor">Apellidos</label>
                        <div class="invalid-feedback">
                          <span>{{ getFieldError('last_name_tutor') }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-sm-6 p-sm-0">
                      <div class="form-group">
                        <input type="text" class="form-control" formControlName="celphone_tutor" id="celphone_tutor"
                          [class.is-invalid]="isFieldInvalid('celphone_tutor')" required>
                        <label for="celphone_tutor">Celular</label>
                        <div class="invalid-feedback">
                          <span>{{ getFieldError('celphone_tutor') }}</span>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-6 p-sm-0">
                      <div class="form-group">
                        <input type="email" class="form-control" formControlName="email_tutor" id="email_tutor"
                          [class.is-invalid]="isFieldInvalid('email_tutor')" required>
                        <label for="email_tutor">Correo electr√≥nico</label>
                        <div class="invalid-feedback">
                          <span>{{ getFieldError('email_tutor') }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <button class="btn step-btn" [disabled]="!isStepValid(1)" (click)="goNextIfValid(1)"><i class="las la-arrow-right"></i> Siguiente</button>
              </div>
              <div class="form-steps" [class.active]="currentStep === 2">
                <h3><i class="las la-shopping-cart"></i> Identificaci√≥n del Bien Contratado</h3>
                <div class="row">
                  <div class="col-sm-12 p-sm-0">
                    <div class="form-group">
                      <div class="select-input">
                        <span></span>

                        <select formControlName="consumption_type_id" id="consumption_type_id" class="form-control"
                          [class.is-invalid]="isFieldInvalid('consumption_type_id')"
                          [class.is-valid]="isFieldValid('consumption_type_id')">
                          <option value="">Elija tipo de consumo</option>
                          <option *ngFor="let type of consumptionTypes" [value]="type.id">
                            {{type.name}}
                          </option>
                        </select>
                        <div class="invalid-feedback">
                          <div class="error-message">{{ getFieldError('consumption_type_id') }}</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6 p-sm-0">
                    <div class="form-group">
                      <input type="number" class="form-control" formControlName="order_number" id="order_number"
                        [class.is-invalid]="isFieldInvalid('order_number')"
                        [class.is-valid]="isFieldValid('order_number')" required>
                      <label for="order_number">N√∫mero de pedido</label>
                      <small class="form-text text-muted">N√∫mero de orden o boleta</small>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('order_number') }}</span>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-6 p-sm-0">
                    <div class="form-group">
                      <input type="number" step="0.01" class="form-control" formControlName="claimed_amount"
                        id="claimed_amount" [class.is-invalid]="isFieldInvalid('claimed_amount')"
                        [class.is-valid]="isFieldValid('claimed_amount')" required>
                      <label for="claimed_amount">Monto reclamado (S/)</label>
                      <small class="form-text text-muted">Monto total del reclamo en soles</small>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('claimed_amount') }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12 p-sm-0">
                    <div class="form-group">
                      <textarea class="form-control" formControlName="description" id="description"
                        [class.is-invalid]="isFieldInvalid('description')" [class.is-valid]="isFieldValid('description')"
                        rows="4" required></textarea>
                      <label for="description">Descripci√≥n del bien o servicio</label>
                      <small class="form-text text-muted">
                        Describe detalladamente el producto o servicio (m√≠nimo 100 caracteres).
                        Actual: {{ claimForm.get('description')?.value?.length || 0 }}/100
                      </small>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('description') }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <button class="btn step-btn" [disabled]="!isStepValid(2)" (click)="goNextIfValid(2)"><i class="las la-arrow-right"></i> Siguiente</button>
              </div>
              <div class="form-steps" [class.active]="currentStep === 3">
                <h3><i class="las la-comment-alt"></i> Detalle de Reclamaci√≥n y Pedido del Consumidor</h3>
                <div class="row">
                  <div class="col-sm-12 p-sm-0">
                    <div class="form-group">
                      <div class="select-input">
                        <span></span>
                        <select formControlName="claim_type_id" id="claim_type_id" class="form-control"
                          [class.is-invalid]="isFieldInvalid('claim_type_id')"
                          [class.is-valid]="isFieldValid('claim_type_id')">
                          <option value="">Seleccione tipo de reclamo</option>
                          <option *ngFor="let type of claimTypes" [value]="type.id">
                            {{type.name}}
                          </option>
                        </select>

                        <div class="invalid-feedback">
                          <div class="error-message">{{ getFieldError('claim_type_id') }}</div>
                        </div>

                        <p class="mt-2">{{sDescription}}</p>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12 p-sm-0">
                    <div class="form-group">
                      <textarea class="form-control" formControlName="detail" id="detail"
                        [class.is-invalid]="isFieldInvalid('detail')" [class.is-valid]="isFieldValid('detail')" rows="4"
                        required></textarea>
                      <label for="detail">Detalle del reclamo</label>
                      <small class="form-text text-muted">
                        Explica qu√© ocurri√≥ y por qu√© presentas este reclamo (m√≠nimo 50 caracteres).
                        Actual: {{ claimForm.get('detail')?.value?.length || 0 }}/50
                      </small>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('detail') }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12 p-sm-0">
                    <div class="form-group">
                      <textarea class="form-control" formControlName="request" id="request"
                        [class.is-invalid]="isFieldInvalid('request')" [class.is-valid]="isFieldValid('request')" rows="4"
                        required></textarea>
                      <label for="request">Tu solicitud</label>
                      <small class="form-text text-muted">
                        Indica claramente qu√© esperas como soluci√≥n (m√≠nimo 100 caracteres).
                        Actual: {{ claimForm.get('request')?.value?.length || 0 }}/100
                      </small>
                      <div class="invalid-feedback">
                        <span>{{ getFieldError('request') }}</span>
                      </div>
                    </div>
                  </div>
                </div>
                <h4 class="block-title"><span class="icon">üìÑ</span> Adjuntar evidencia (opcional)</h4>
                <div class="row">
                  <div class="col-sm-12 p-sm-0">
                    <div class="form-group">
                      <div class="file-upload-wrapper">
                        <div class="custom-file" *ngIf="!selectedFileName">
                          <input type="file" class="custom-file-input form-control" formControlName="attachment"
                            id="attachment" (change)="onFileSelected($event)" accept=".pdf,.doc,.docx">
                          <label class="custom-file-label" for="attachment">
                            <span class="file-return">
                              <i class="las la-cloud-upload-alt"></i>
                              Selecciona un archivo o arr√°stralo aqu√≠
                            </span>
                          </label>
                        </div>
                        <div class="file-preview" *ngIf="selectedFileName">
                          <div class="file-info">
                            <i class="las la-file-alt file-icon"></i>
                            <span class="file-name">{{ selectedFileName }}</span>
                          </div>
                          <button type="button" class="btn-remove" (click)="removeAttachment()"
                            aria-label="Eliminar archivo">
                            <i class="las la-trash"></i> Eliminar
                          </button>
                        </div>
                      </div>
                      <small class="form-text text-muted">
                        Formatos: PDF, DOC, DOCX | Tama√±o m√°ximo: 150KB
                      </small>
                    </div>
                  </div>
                </div>
                <button class="btn step-btn" [disabled]="!isStepValid(3)" (click)="goNextIfValid(3)"><i class="las la-eye"></i> Revisar antes de enviar</button>
              </div>
              <div class="form-steps review-step" [class.active]="currentStep === 4">
                <h3><i class="las la-check-circle"></i> Revisi√≥n de tu Reclamo</h3>
                <p class="review-intro">Por favor verifica que toda la informaci√≥n sea correcta antes de enviar</p>

                <div class="review-section">
                  <h4 class="review-section-title">Datos del Consumidor</h4>
                  <div class="review-item">
                    <span class="review-label">Nombre completo:</span>
                    <span class="review-value">{{ claimForm.get('first_name')?.value }} {{
                      claimForm.get('last_name')?.value }}</span>
                  </div>
                  <div class="review-item">
                    <span class="review-label">Documento:</span>
                    <span class="review-value">{{ claimForm.get('document_number')?.value }}</span>
                  </div>
                  <div class="review-item">
                    <span class="review-label">Email:</span>
                    <span class="review-value">{{ claimForm.get('email')?.value }}</span>
                  </div>
                  <div class="review-item">
                    <span class="review-label">Tel√©fono:</span>
                    <span class="review-value">{{ claimForm.get('celphone')?.value }}</span>
                  </div>
                  <div class="review-item">
                    <span class="review-label">Direcci√≥n:</span>
                    <span class="review-value">{{ claimForm.get('address')?.value }}</span>
                  </div>
                </div>

                <div class="review-section" *ngIf="isYouger">
                  <h4 class="review-section-title">Datos del Tutor Legal</h4>
                  <div class="review-item">
                    <span class="review-label">Nombre completo:</span>
                    <span class="review-value">{{ claimForm.get('first_name_tutor')?.value }} {{
                      claimForm.get('last_name_tutor')?.value }}</span>
                  </div>
                  <div class="review-item">
                    <span class="review-label">Documento:</span>
                    <span class="review-value">{{ claimForm.get('document_number_tutor')?.value }}</span>
                  </div>
                  <div class="review-item">
                    <span class="review-label">Email:</span>
                    <span class="review-value">{{ claimForm.get('email_tutor')?.value }}</span>
                  </div>
                </div>

                <div class="review-section">
                  <h4 class="review-section-title">Detalles del Reclamo</h4>
                  <div class="review-item">
                    <span class="review-label">N√∫mero de pedido:</span>
                    <span class="review-value">{{ claimForm.get('order_number')?.value }}</span>
                  </div>
                  <div class="review-item">
                    <span class="review-label">Monto:</span>
                    <span class="review-value">S/ {{ claimForm.get('claimed_amount')?.value }}</span>
                  </div>
                  <div class="review-item">
                    <span class="review-label">Detalle:</span>
                    <span class="review-value">{{ claimForm.get('detail')?.value }}</span>
                  </div>
                  <div class="review-item">
                    <span class="review-label">Solicitud:</span>
                    <span class="review-value">{{ claimForm.get('request')?.value }}</span>
                  </div>
                  <div class="review-item" *ngIf="selectedFileName">
                    <span class="review-label">Archivo adjunto:</span>
                    <span class="review-value"><i class="las la-file-alt"></i> {{ selectedFileName }}</span>
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-12 p-sm-0">
                    <div class="form-group captcha-wrapper">
                      <label class="captcha" id="captcha">
                        <re-captcha formControlName="recaptcha"
                          (resolved)="addTokenLog('Reactive form mode resolved', $event)">
                        </re-captcha>
                      </label>
                    </div>
                    <button [disabled]="claimForm.invalid || isSubmitting" class="btn btn-submit" (click)="onSave()">
                      <span *ngIf="!isSubmitting"><i class="las la-paper-plane"></i> Enviar Reclamo</span>
                      <span *ngIf="isSubmitting"><span class="spinner-border spinner-sm"></span> Enviando...</span>
                    </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="footer">
      <div class="copyright">
        <p>
          <strong>{{branding?.companyName}}</strong> - RUC: {{branding?.companyRuc}}<br>
          Copyright ¬© {{currentYear}} {{branding?.companyBrand}} | Todos los derechos reservados
        </p>
      </div>
    </div>
  </div>
</div>
